---
---

<script>
	// import { darkMode, updateHtmlTheme, updateModeCircle } from "../lib/store.ts";

	function updateTheme() {
		if (typeof window === "undefined") return;
		const storedSession = Boolean(sessionStorage?.getItem("darkMode"));
		const rootHtml = document.documentElement.classList;
		const prefersDarkTheme = window.matchMedia(
			"(prefers-color-scheme: dark)"
		).matches;

		if (storedSession) {
			!dark;
		} else darkMode.set(prefersDarkTheme);

		updateHtmlTheme();
		updateModeCircle();
	}

	updateTheme;

	document.addEventListener("astro:after-swap", () => {
		updateHtmlTheme;
		updateModeCircle;
	});
	export function updateModeCircle() {
		const toggleButtonCircle = document.querySelector(
			"#mode-circle"
		) as HTMLElement;

		toggleButtonCircle.classList.toggle(darkMode.get() ? "dark" : "light");
	}

	export function updateHtmlTheme() {
		const themeColorMetaTag = document.head.querySelector(
			'meta[name="theme-color"]'
		) as HTMLMetaElement;

		if (themeColorMetaTag) {
			document.documentElement.classList.toggle("dark", darkMode.get());
			themeColorMetaTag.content = darkMode.get()
				? darkColor.get()
				: lightColor.get();
		}
	}
</script>
